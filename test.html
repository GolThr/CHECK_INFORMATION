<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TEST</title>
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="styles/main_styles.css" type="text/css"/>
    <link rel="stylesheet" href="styles/common_styles.css" type="text/css"/>
    <style type="text/css">
        body{
            padding: 20px;
        }


        .main_calendar_borderstyle{
            cursor: pointer;
            width: 240px;
            height: 40px;
            border-radius: 10px;
            background: #fff;
            border: #EAEDF6 solid 2px;
            position: relative;
        }
        .main_calendar_borderstyle .main_calendar_select_body{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: #fff;
            border: #EAEDF6 solid 2px;
            position: absolute;
            top: 50px;
            left: 0;
            right: 0;
            padding: 10px;
            display: none;
        }
        .main_calendar_borderstyle:hover{
            border-color: #458CFE;
        }


        .main_calendar_cardstyle{
            cursor: pointer;
            width: 240px;
            height: 40px;
            border-radius: 10px;
            background: #fff;
            box-shadow: 0 0 5px 2px #F2F2F2;
            position: relative;
        }
        .main_calendar_cardstyle .main_calendar_select_body{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: #fff;
            box-shadow: 0 4px 5px 2px #F2F2F2;
            position: absolute;
            top: 50px;
            left: 0;
            right: 0;
            padding: 10px;
            display: none;
        }
        .main_calendar_cardstyle:hover{
            background: #EAEDF6;
        }
        .main_calendar_select_header{
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-around;
            width: 100%;
            height: 40px;
        }
        .main_calendar_pre_m,.main_calendar_next_m{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 20px;
            height: 20px;
        }
        .main_calendar_pre_m:before{
            content: "";
            width: 12px;
            height: 2px;
            background: #000;
            border-radius: 1px;
            transform: rotate(-45deg);
            position: absolute;
            top: 5px;
        }
        .main_calendar_pre_m:after{
            content: "";
            width: 12px;
            height: 2px;
            background: #000;
            border-radius: 1px;
            transform: rotate(45deg);
            position: absolute;
            bottom: 5px;
        }
        .main_calendar_next_m:before{
            content: "";
            width: 12px;
            height: 2px;
            background: #000;
            border-radius: 1px;
            transform: rotate(45deg);
            position: absolute;
            top: 5px;
        }
        .main_calendar_next_m:after{
            content: "";
            width: 12px;
            height: 2px;
            background: #000;
            border-radius: 1px;
            transform: rotate(-45deg);
            position: absolute;
            bottom: 5px;
        }
        .main_calendar_select_header img{
            width: 20px;
            height: 20px;
        }
        .main_calendar_select_header_body{
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 40px;
        }
        .main_calendar_select_header_body span{
            text-align: center;
            color: #000;
            font-size: 14px;
        }
        .main_calendar_select_title{
            cursor: default;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            width: 100%;
            font-size: 14px;
            font-weight: bold;
            color: #458CFE;
            height: 30px;
        }
        .main_calendar_select_title span{
            line-height: 30px;
            width: 30px;
            text-align: center;
        }
        .main_calendar_select_week{
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-around;
            width: 100%;
            font-size: 14px;
            color: #000;
            height: 30px;
        }
        .main_calendar_select_week span{
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            text-align: center;
        }
        .main_calendar_select_week_active:hover{
            color: #000;
            background: #EAEDF6;
        }
        .main_calendar_select_week_grey{
            color: #9fa7ad;
        }
        .main_calendar_select_week_grey:hover{
            color: #9fa7ad;
            background: #fff;
        }
        .main_calendar_selected{
            color: #fff;
            background: #458CFE;
        }
        .main_calendar_selected:hover{
            color: #fff;
            background: #458CFE;
        }
        .main_calendar_arrow{
            position: absolute;
            width: 10px;
            height: 10px;
            top: 15px;
            right: 10px;
            transition: transform 200ms;
        }
        .main_select_arrow_down{
            transform: rotate(180deg);
        }
        .main_select_placeholder{
            font-size: 14px;
            line-height: 40px;
            text-align: center;
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 24px;
        }
    </style>
</head>
<body>

    <!--日历选取-->
    <div class="main_calendar_cardstyle" id="calendar1" onclick="mainCalendarToggleById('calendar1')">
        <img class="main_calendar_arrow" src="images/ic_down_arrow.png"/>
        <span class="main_select_placeholder">请选择日期</span>
        <div class="main_calendar_select_body">
            <div class="main_btn_line" style="justify-content: flex-end;">
                <span class="dialog_btn_seco">取消</span>
                <span class="dialog_btn_main">确定</span>
            </div>
        </div>
    </div>
    <!--日历选取-->
    <div class="main_calendar_cardstyle" id="calendar2" onclick="mainCalendarToggleById('calendar2')">
        <img class="main_calendar_arrow" src="images/ic_down_arrow.png"/>
        <span class="main_select_placeholder">请选择日期</span>
        <div class="main_calendar_select_body">
            <div class="main_btn_line" style="justify-content: flex-end;">
                <span class="dialog_btn_seco">取消</span>
                <span class="dialog_btn_main">确定</span>
            </div>
        </div>
    </div>


    <script type="text/javascript">
        function mainCalendarToggleById(id) {
            var cal_body = $('#'+id);
            var cal_arrow = $('#'+id+' .main_calendar_arrow');
            var select_body = $('#'+id+' .main_calendar_select_body');

            var show = cal_body.attr('d');
            select_body.click(function (event) {
                event.stopPropagation();
            });

            if(show == undefined || show == '' || show == 'false'){
                cal_body.attr('d', 'true');
                var myDate = new Date();
                initMainCalendarById(id, myDate.getFullYear(), myDate.getMonth() + 1, myDate.getDate(), myDate.getDay());
                select_body.css('z-index', '11');
                select_body.slideDown(200);
                cal_arrow.addClass('main_select_arrow_down');
            }else{
                cal_body.attr('d', 'false');
                select_body.slideUp(200);
                select_body.css('z-index', '10');
                cal_arrow.removeClass('main_select_arrow_down');
            }
        }

        function initMainCalendarById(id, y, m, d, week) {
            var cal_val = $('#'+id+' .main_select_placeholder');
            var days = [31, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31];
            var cur_days = [];
            var cur_y = y;
            var cur_m = m;
            var cur_d = d;
            var cur_w = week;

            var show_m = m > 9 ? m : '0' + m;
            var show_d = d > 9 ? d : '0' + d;
            cal_val.text(y+'-'+show_m+'-'+show_d);
            if((cur_y[0]+cur_y[1]+cur_y[2]+cur_y[3]) % 4 == 0){
                days[2] = 29;
            }
            if(cur_w == 0) cur_w = 7;
            if(cur_d > 7){
                while(cur_d > 7){
                    cur_d -= 7;
                }
            }
            while(cur_d > 1){
                cur_d--;
                cur_w--;
                if(cur_w == 0) cur_w = 7;
            }
            for(var i = 1; i < cur_w; i++){
                var t = {"date":days[cur_m - 1]--,"cur":"0"};
                cur_days.unshift(t);
            }
            for(var i = 1; i <= days[cur_m]; i++){
                var t = {"date":i,"cur":"1"};
                cur_days.push(t);
            }
            for(var i = cur_w - 1 + days[cur_m], j = 1; i <= 42; i++){
                var t = {"date":j++,"cur":"0"};
                cur_days.push(t);
            }
            console.log(cur_days);
            console.log(cur_w);
            renderMainCalendarById(id, cur_days, y, m, d, week);
        }

        function renderMainCalendarById(id, cur_days, y, m, d, week) {
            var select_body = $('#'+id+' .main_calendar_select_body');
            var show_m = m > 9  ? m : '0' + m;
            var show_d = d > 9  ? d : '0' + d;

            select_body.html('');
            // render header
            select_body.append('<div class="main_calendar_select_header">\n' +
                '                <div class="main_calendar_pre_m" onclick="mainCalendarGetPreMonth(\''+id+'\')"></div>\n' +
                '                <div class="main_calendar_select_header_body" onclick="mainCalendarBackToday(\''+id+'\')">\n' +
                '                    <span class="main_calendar_select_header_body_title" y="'+y+'" m="'+m+'" d="'+d+'" w="'+week+'">'+y+'年'+show_m+'月'+show_d+'日</span>\n' +
                '                    <span style="font-size: 12px;color: #458CFE;">点此返回今天</span>\n' +
                '                </div>\n' +
                '                <div class="main_calendar_next_m" onclick="mainCalendarGetNextMonth(\''+id+'\')"></div>\n' +
                '            </div>\n' +
                '            <div class="main_calendar_select_title">\n' +
                '                <span>一</span>\n' +
                '                <span>二</span>\n' +
                '                <span>三</span>\n' +
                '                <span>四</span>\n' +
                '                <span>五</span>\n' +
                '                <span>六</span>\n' +
                '                <span>日</span>\n' +
                '            </div>');
            for(var i = 0; i < 42; i++){
                var line = '<div class="main_calendar_select_week">';
                while((i + 1) % 7 != 0){
                    var date = cur_days[i]['date'];
                    var w = (i + 1) % 7 == 0 ? 7 : (i + 1) % 7;
                    if(cur_days[i]['cur'] == 0){
                        line += '<span class="main_calendar_select_week_grey">'+date+'</span>';
                    }else{
                        if(date == d){
                            line += '<span class="main_calendar_select_week_active main_calendar_selected" y="'+y+'" m="'+m+'" d="'+date+'" w="'+w+'" onclick="onSelectMainCalendarDate(\''+id+'\',this)">'+date+'</span>';
                        }else{
                            line += '<span class="main_calendar_select_week_active" y="'+y+'" m="'+m+'" d="'+date+'" w="'+w+'" onclick="onSelectMainCalendarDate(\''+id+'\',this)">'+date+'</span>';
                        }
                    }
                    i++
                }
                var date = cur_days[i]['date'];
                var w = (i + 1) % 7 == 0 ? 7 : (i + 1) % 7;
                if(cur_days[i]['cur'] == 0){
                    line += '<span class="main_calendar_select_week_grey">'+date+'</span>';
                }else{
                    if(date == d){
                        line += '<span class="main_calendar_select_week_active main_calendar_selected" y="'+y+'" m="'+m+'" d="'+date+'" w="'+w+'" onclick="onSelectMainCalendarDate(\''+id+'\',this)">'+date+'</span>';
                    }else{
                        line += '<span class="main_calendar_select_week_active" y="'+y+'" m="'+m+'" d="'+date+'" w="'+w+'" onclick="onSelectMainCalendarDate(\''+id+'\',this)">'+date+'</span>';
                    }
                }
                line += '</div>';
                select_body.append(line);
            }
            select_body.append('<div class="main_btn_line" style="margin-top:10px;justify-content: flex-end;">\n' +
                '                <span class="dialog_btn_seco" onclick="mainCalendarBackToday(\''+id+'\');mainCalendarToggleById(\''+id+'\')">取消</span>\n' +
                '                <span class="dialog_btn_main" onclick="mainCalendarToggleById(\''+id+'\')">确定</span>\n' +
                '            </div>');
        }

        function mainCalendarBackToday(id) {
            var myDate = new Date();
            initMainCalendarById(id, myDate.getFullYear(), myDate.getMonth() + 1, myDate.getDate(), myDate.getDay());
        }
        
        function mainCalendarGetPreMonth(id) {
            var selected_span = $('#'+id+' .main_calendar_select_body .main_calendar_select_header .main_calendar_select_header_body .main_calendar_select_header_body_title');
            var to_y = selected_span.attr('y') - 0;
            var to_m = selected_span.attr('m') - 1;
            var to_d = selected_span.attr('d') - 0;
            var to_w = selected_span.attr('w') - 0;
            if(to_m < 1){
                to_m = 12;
                to_y -= 1;
            }
            //distance
            var days = [31, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31];
            if((to_y[0]+to_y[1]+to_y[2]+to_y[3]) % 4 == 0){
                days[2] = 29;
            }
            var distance = days[to_m];
            console.log(distance);
            while(distance > 7){
                distance -= 7;
            }
            console.log(distance);
            while(distance > 0){
                distance--;
                to_w--;
                if(to_w == 0) to_w = 7;
            }
            initMainCalendarById(id, to_y, to_m, to_d, to_w);
        }

        function mainCalendarGetNextMonth(id) {
            var selected_span = $('#'+id+' .main_calendar_select_body .main_calendar_select_header .main_calendar_select_header_body .main_calendar_select_header_body_title');
            var to_y = selected_span.attr('y') - 0;
            var to_m = selected_span.attr('m') - 0 + 1;
            var to_d = selected_span.attr('d') - 0;
            var to_w = selected_span.attr('w') - 0;
            if(to_m > 12){
                to_m = 1;
                to_y += 1;
            }
            //distance
            var days = [31, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31];
            if((to_y[0]+to_y[1]+to_y[2]+to_y[3]) % 4 == 0){
                days[2] = 29;
            }
            var distance = days[to_m - 1];
            console.log(distance);
            while(distance > 7){
                distance -= 7;
            }
            console.log(distance);
            while(distance > 0){
                distance--;
                to_w++;
                if(to_w == 8) to_w = 1;
            }
            initMainCalendarById(id, to_y, to_m, to_d, to_w);
        }

        function onSelectMainCalendarDate(id, obj) {
            var cal_val = $('#'+id+' .main_select_placeholder');
            var selected_span = $('#'+id+' .main_calendar_select_body .main_calendar_select_header .main_calendar_select_header_body .main_calendar_select_header_body_title');
            var y = $(obj).attr('y');
            var m = $(obj).attr('m');
            var d = $(obj).attr('d');
            var w = $(obj).attr('w');
            var show_m = m > 9 ? m : '0' + m;
            var show_d = d > 9 ? d : '0' + d;
            selected_span.attr('y', y);
            selected_span.attr('m', m);
            selected_span.attr('d', d);
            selected_span.attr('w', w);
            selected_span.text(y+'年'+show_m+'月'+show_d+'日');
            cal_val.text(y+'-'+show_m+'-'+show_d);
            clearMainCalendarSelected(id);
            $(obj).addClass('main_calendar_selected');
        }

        function clearMainCalendarSelected(id) {
            $('#'+id+' .main_calendar_select_body .main_calendar_select_week span').each(function (index, elem) {
                $(elem).removeClass('main_calendar_selected');
            });
        }

        function getMainCalendarSelectedById(id) {
            return $('#'+id+' .main_select_placeholder').text();
        }
    </script>
</body>
</html>